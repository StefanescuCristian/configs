###########################
### RHEL/CentOS install ###
###########################

### Link for netinstall ##
http://ftp.astral.ro/distros/centos/6.4/os/x86_64/

###########
### yum ###
###########

yum update		# update toate pachetele si dependintele lor
yum search nume_pachet	# cauta un anume pachet, pot fi mai multe pachete trecute
yum info nume_pachet	# afiseaza detalii despre un anume pachet
yum list nume_pache    	# afiseaza informatii despre un anumit pachet, instalat sau nu
yum list nume_pachet\* 	# afiseaza informatii despre toate pachetele care incep cu un nume
yum list all		# afiseaza toate pachetele disponibile 
yum list installed "*nume_pachet*"  # afiseaza pachetele instalate care contine un nume
yum list installed | grep reponame  # afiseaza pachetele instalate dintr-un repo
yum list available	# afiseaza pachetele disponibile in functie de repo-urile instalate
yum repolist		# afiseaza repo-urile instalate
yum gruplist		# afiseaza
yum install nume_pachet\* # instaleaza toate pachetele care incep cu un nume
yum downgrade nume_pachet
yum provides "*/nume_pachet" # afiseaza fisierele care le detine un pachet
yum -v grouplist kde\*  # listeaza toate pachetele ce tin de KDE
yum groupinstall "KDE Software Compilation" # instaleaza toate pachetele ce tin de KDE
yum groupinstall kde-desktop
yum install @kde-desktop  # @ pentru a instala un grup
yum remove nume_pachet
yum groupremove "KDE Software Compilation"
yum groupremove kde-desktop
yum remove @kde-desktop
yum history list
yum history list nume_pachet
yum repolist all  # list all repositories set up on your system
yum --exclude=packagename\* ...

################
### yum.conf ###
################

### skip updating packages ###
yum -x nume_pachet update
yum --exclude=nume_pachet update

sudo vim /etc/yum.conf  # permanent
_______
[main]
exclude=nume_pachet1* nume_pachet2*
_______
yum --disableexcludes=all update  # disable exclude to check for an update


### Remove Old Kernels ###
# Package-cleanup set count as how many old kernels you want left #
package-cleanup --oldkernels --count=2

# Make Amount of Installed Kernels Permanent #
vim /etc/yum.conf # and set installonly_limit:
installonly_limit=2

### Removing dependencies###
sudo vim /etc/yum.conf
______________________________
[main]
clean_requirements_on_remove=1
______________________________


######################
### YUM & RPM tips ###
######################

#Query packages not from CentOS #
rpm -qa --qf '%{NAME} %{VENDOR}\n' | grep -v CentOS

# Reset File Permissions #
rpm --setperms <packagename>

# View the Changelog of a package #
rpm -q --changelog <packagename> | less

# quickly list documentation relating to a package #
rpm -qd <packagename>

# Query Package Install Order and Dates #
rpm -qa --last > ~/RPMS_by_Install_Date

# Query Available Packages from a Repo #
yum --disablerepo "*" --enablerepo "rpmforge" list available 

# Enable or Disable a Repo from the Command Line #
yum-config-manager --enable c6-media
yum-config-manager --disable c6-media

# Show all installed GPG keys #
rpm -q gpg-pubkey --qf '%{name}-%{version}-%{release} --> %{summary}\n'


### package-cleanup ###
package-cleanup --orphans
package-cleanup --leaves
package-cleanup --dupes
package-cleanup --problems
package-cleanup --oldkernel



### Fonts config ###
vim ~/.fonts.conf
__________________________________________
<?xml version='1.0'?>
<!DOCTYPE fontconfig SYSTEM 'fonts.dtd'>
<fontconfig>
 <match target="font">
  <edit mode="assign" name="rgba">
   <const>rgb</const>
  </edit>
 </match>
 <match target="font">
  <edit mode="assign" name="hinting">
   <bool>true</bool>
  </edit>
 </match>
 <match target="font">
  <edit mode="assign" name="hintstyle">
   <const>hintslight</const>
  </edit>
 </match>
 <match target="font">
  <edit mode="assign" name="antialias">
   <bool>true</bool>
  </edit>
 </match>
  <match target="font">
    <edit mode="assign" name="lcdfilter">
      <const>lcddefault</const>
    </edit>
  </match>
</fontconfig>
__________________________________________


### Add an user to SUDOERS ###
su -
visudo
sergiu		ALL=(ALL)	ALL

Or add the user to wheel group and enable wheel from visudo


#############
### Repos ###
#############
rpm -Uvh http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm

# Multimedia #
rpm -Uvh http://pkgs.repoforge.org/rpmforge-release/rpmforge-release-0.5.3-1.el6.rf.x86_64.rpm

rpm -Uvh http://li.nux.ro/download/nux/dextop/el6/x86_64/nux-dextop-release-0-2.el6.nux.noarch.rpm
sudo yum --enablerepo=nux-dextop-testing install xbmc

# nVidia driver #
rpm -Uvh http://elrepo.org/elrepo-release-6-5.el6.elrepo.noarch.rpm
http://elrepo.org/linux/extras/el6/x86_64/RPMS/   # extras
http://elrepo.org/linux/testing/el6/x86_64/RPMS/  # testing
sudo yum install kmod-nvidia
sudo yum install nvidia-x11-drv

# Last kernel & lts kernel #
http://elrepo.org/linux/kernel/el6/x86_64/RPMS/   # kernel
sudo yum --enablerepo=elrepo-kernel install kernel-lt
sudo yum --enablerepo=elrepo-kernel install kernel-ml

# Others #
rpm -Uvh http://download1.rpmfusion.org/free/el/updates/6/x86_64/rpmfusion-free-release-6-0.1.noarch.rpm http://download1.rpmfusion.org/nonfree/el/updates/6/x86_64/rpmfusion-nonfree-release-6-0.1.noarch.rpm	# (not needed if nux-dextop is installed) 


### Install Chromium ###
cd /etc/yum.repos.d
wget http://people.centos.org/hughesjr/chromium/6/chromium-el6.repo
yum install chromium
sudo setsebool -P mmap_low_allowed 1


### Others ###
yum install bash-completion
yum install nautilus-open-terminal
yum install flash-plugin
yum install gconf-editor
yum install gnome-utils
yum install file-roller
yum install ntfsprogs

### Apps ###
yum install pidgin pidgin-plugin-pack skype
yum install geany filezilla transmission mc
yum install radiotray tv-maxe xbmc clementine


### Change the hostname ###
hostname   # to check your hostname
sudo hostname RedHat
vim /etc/sysconfig/network


### Dropbox ###
vim /etc/sysconfig/dropbox  # DROPBOX_USERS="sergiu"
echo '-b /usr/libexec/dropbox/' > /etc/prelink.conf.d/dropbox.conf
yum --enablerepo rpmforge reinstall dropbox


### Install LibreOffice 4.1.0 ###
wget http://download.documentfoundation.org/libreoffice/stable/4.1.0/rpm/x86_64/LibreOffice_4.1.0_Linux_x86-64_rpm.tar.gz
tar -xvf LibreOffice_4.1.0*
cd LibreOffice_4.1.0*
yum localinstall RPMS/*.rpm RPMS/desktop-integration/libreoffice4.1-freedesktop-menus-4.1.0*.noarch.rpm


### Install vbox additions ###
yum install gcc kernel-devel kernel-headers dkms make bzip2
KERN_DIR=/usr/src/kernels/`uname -r`
export KERN_DIR
cd /media/VirtualBoxGuestAdditions
./VBoxLinuxAdditions.run


### Remove boot splash screen ###
vim /etc/grub.conf  # remove ‘rhgb’ and ‘quiet’


### Remove Desktop icons ###
yum install gconf-editor
apps > nautilus > desktop


### Multimedia support ###
sudo yum install gstreamer gstreamer-plugins-base gstreamer-plugins-good gstreamer-plugins-bad-free
sudo yum install gstreamer-plugins-bad gstreamer-plugins-ugly gstreamer-ffmpeg


### Save alsamixer settings ###
sudo alsactl store
ls -Z /etc/asound.*  # to see SElinux label

sudo vim /etc/pulse/daemon.conf
_______________________________
enable-remixing = yes
enable-lfe-remixing = yes
default-sample-format = s32le
default-sample-rate = 48000
default-sample-channels = 6
default-fragments = 8
default-fragment-size-msec = 5
________________________________

pulseaudio -k  # restart pulseaudio



####################################
### CentOS Protection & Security ###
####################################
# Securing and Hardening Red Hat Linux Production Systems
http://www.puschitz.com/SecuringLinux.shtml
https://access.redhat.com/site/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Security_Guide/index.html

### SElinux ###
Two important documentations about Selinux can be found here:
http://docs.redhat.com/docs/en-US/Red_Hat_Enterprise_Linux/6/html/Security-Enhanced_Linux/index.html
http://docs.redhat.com/docs/en-US/Red_Hat_Enterprise_Linux/6/html/Managing_Confined_Services/index.html

# You can view current status of SELinux mode from the command line using these:
system-config-selinux
getenforce  # if you get back a 1 selinux is turned on if you get back a 0 its turned off
sestatus

# If it is disabled, enable SELinux using the following command.
setenforce enforcing  # changes do not persist through a system reboot
To make changes persistent through a system reboot, edit the 'SELINUX=' line in  /etc/selinux/config for either 'enforcing', 'permissive', or 'disabled'. For example: 'SELINUX=permissive'


# SElinux logs (/var/log/audit/audit.log) #
yum install setroubleshoot
setroubleshootd
sealert -a /var/log/audit/audit.log  # if you only have a console available and no X-Window System
sealert -b  # if you have gui


# SElinux re-labelling #
touch /.autorelabel
sudo reboot


### Password Protect Grub and Single-User Mode ###
# It is highly important to protect your bootloader. 
# There is a magic kernel parameter called init=/bin/sh. This makes any user/login restrictions totally useless.

grub-crypt
vim /etc/grub.conf
______________________________________________
default=0
timeout=2
splashimage=(hd0,0)/grub/splash.xpm.gz
hiddenmenu
password --encrypted $6$w1lrwrXOMm5ueR4M$.....
______________________________________________


vim /etc/sysconfig/init
_______________________
PROMPT=no

SINGLE=/sbin/sulogin
_______________________


### Modifying fstab ###

vim /etc/fstab
____________________________________________________________________
/dev/sda1	/boot	ext4	defaults,nosuid,noexec,nodev	1 2
/dev/sda2	swap	swap	defaults			0 0
/dev/sda3	/	ext4	defaults			1 1
/dev/sda4	/home	ext4	defaults,nosuid,nodev		1 2

# Others partitions 
		/tmp	ext4	defaults,nosuid,noexec,nodev	1 2
		/var/tmp ext4	defaults,nosuid,noexec,nodev	1 2
		/var	ext4	defaults,nosuid			1 2
		/var/www ext4	defaults,nosuid,nodev		1 2
/dev/shm	tmpfs		defaults			0 0
devpts		/dev/pts devpts	gid=5,mode=620			0 0
sysfs		/sys	sysfs	defaults			0 0
proc		/proc	proc	defaults			0 0

____________________________________________________________________
# Note that some packages (building nvidia-dkms for example) may require exec on /var

# Keep /boot as read-only #
# Note that you need to reset the change to read-write if you need to upgrade the kernel in future
/dev/sda1	/boot	ext4	defaults,nosuid,noexec,nodev,ro	1 2


### Umask restrictions  ###
# Set a umask of 077 for maximum security, which makes new files not readable by users other than the owner.
perl -npe 's/umask\s+0\d2/umask 077/g' -i /etc/bashrc
perl -npe 's/umask\s+0\d2/umask 077/g' -i /etc/csh.cshrc


### Disable Control -Alt -Delete keys on the console mode ###
vim /etc/init/control-alt-delete.conf
______________________________
# start on control-alt-delete
# exec /sbin/shutdown -r now "Control -Alt -Delete pressed"
______________________________


### Disable USB mass storage ###
echo "Disabling USB Mass Storage"
echo "blacklist usb-storage" > /etc/modprobe.d/blacklist-usbstorage

### Disable USB stick to detect ###
vim /etc/modprobe.d/no-usb
_____________________________
install usb-storage /bin/true
_____________________________


### Secure the /etc/services file to prevent unauthorized editing ###
# This prevents the file from being renamed, deleted or having links made to it.
chown root.root /etc/services
chmod 0644 /etc/services
chattr +i /etc/services


########################
### Network Security ###
########################

## Wireless has to go ###
for i in $(find /lib/modules/`uname -r`/kernel/drivers/net/wireless -name "*.ko" -type f) ; do echo blacklist $i >> /etc/modprobe.d/blacklist-wireless ; done


### Sysctl ###
vim /etc/sysctl.conf
_______________________________________________
### ipv4 Security options ###

# Disable IP Source Routing #
# Source Routing is used to specify a path or route through the network from source to destination. 
# This feature can be used by network people for diagnosing problems. 
# However, if an intruder was able to send a source routed packet into the network, then he could intercept the replies and your server might not know that it's not communicating with a trusted server. 
net.ipv4.conf.all.accept_source_route = 0

# Disable ICMP Redirect Acceptance #
# ICMP redirects are used by routers to tell the server that there is a better path to other networks than the one chosen by the server. 
# However, an intruder could potentially use ICMP redirect packets to alter the hosts's routing table by causing traffic to use a path you didn't intend. 
net.ipv4.conf.all.accept_redirects = 0

# Enable IP Spoofing Protection #
# IP spoofing is a technique where an intruder sends out packets which claim to be from another host by manipulating the source address. 
# IP spoofing is very often used for denial of service attacks.
net.ipv4.conf.all.rp_filter = 1

# Enable Ignoring to ICMP Requests #
net.ipv4.icmp_echo_ignore_all = 1

# Enable Ignoring Broadcasts Request #
net.ipv4.icmp_echo_ignore_broadcasts = 1

# Enable Bad Error Message Protection #
net.ipv4.icmp_ignore_bogus_error_responses = 1

# Enable Logging of Spoofed Packets, Source Routed Packets, Redirect Packets #
net.ipv4.conf.all.log_martians = 1

# Others ipv4 security options #
net.ipv4.conf.all.send_redirects = 0
net.ipv4.conf.all.secure_redirects = 0
net.ipv4.conf.default.accept_redirects = 0
net.ipv4.conf.default.secure_redirects = 0
net.ipv4.conf.default.send_redirects = 0
net.ipv4.tcp_max_syn_backlog = 1280
net.ipv4.tcp_timestamps = 0

### Memory/Swap Use ###
vm.swappiness = 1
vm.vfs_cache_pressure = 50
_______________________________________________

sysctl -p


### IPTables ###
sudo vim /etc/sysconfig/iptables
____________________________________________________________________________
#Drop anything we aren't explicitly allowing. All outbound traffic is okay
*filter
:INPUT DROP [0:0]
:FORWARD DROP [0:0]
:OUTPUT ACCEPT [0:0]
:RH-Firewall-1-INPUT - [0:0]
-A INPUT -j RH-Firewall-1-INPUT
-A FORWARD -j RH-Firewall-1-INPUT
-A RH-Firewall-1-INPUT -i lo -j ACCEPT
-A RH-Firewall-1-INPUT -p icmp --icmp-type echo-reply -j ACCEPT
-A RH-Firewall-1-INPUT -p icmp --icmp-type destination-unreachable -j ACCEPT
-A RH-Firewall-1-INPUT -p icmp --icmp-type time-exceeded -j ACCEPT
# Accept Pings
-A RH-Firewall-1-INPUT -p icmp --icmp-type echo-request -j ACCEPT
# Log anything on eth0 claiming it's from a local or non-routable network
# If you're using one of these local networks, remove it from the list below
-A INPUT -i eth0 -s 10.0.0.0/8 -j LOG --log-prefix "IP DROP SPOOF A: "
-A INPUT -i eth0 -s 172.16.0.0/12 -j LOG --log-prefix "IP DROP SPOOF B: "
-A INPUT -i eth0 -s 192.168.0.0/16 -j LOG --log-prefix "IP DROP SPOOF C: "
-A INPUT -i eth0 -s 224.0.0.0/4 -j LOG --log-prefix "IP DROP MULTICAST D: "
-A INPUT -i eth0 -s 240.0.0.0/5 -j LOG --log-prefix "IP DROP SPOOF E: "
-A INPUT -i eth0 -d 127.0.0.0/8 -j LOG --log-prefix "IP DROP LOOPBACK: "
# Accept any established connections
-A RH-Firewall-1-INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
# Accept ssh traffic. Restrict this to known ips if possible.
#-A RH-Firewall-1-INPUT -m state --state NEW -m tcp -p tcp --dport 22 -j ACCEPT
#Log and drop everything else
-A RH-Firewall-1-INPUT -j LOG
-A RH-Firewall-1-INPUT -j DROP
COMMIT
______________________________________________________________________________



### Detecting Listening Network Ports ###
netstat -tulpn

### Services configuration ###
chkconfig --list		# list all known services
chkconfig --list | grep 3:on	# list running services
chkconfig [service] on/off	# turn on / off service

sudo chkconfig atd off
sudo chkconfig blk-availability off
sudo chkconfig bluetooth off
sudo chkconfig mdmonitor off
sudo chkconfig lvm2-monitor off
sudo chkconfig iscsi off
sudo chkconfig iscsid off
sudo chkconfig nfslock off
sudo chkconfig rpcbind off
sudo chkconfig rpcgssd off
sudo chkconfig rpcidmapd off
sudo chkconfig livesys off
sudo chkconfig livesys-late off
sudo chkconfig pcscd off
sudo chkconfig openct off
sudo chkconfig postfix off


##############
### Others ###
##############

### Wake-on-lan ###
echo '/usr/sbin/ethtool -s eth0 wol g' >> /etc/rc.d/rc.local
or
vim /etc/sysconfig/network-scripts/ifcfg-eth0
_____________________
DEVICE=eth0
TYPE=EThernet 
ONBOOT=yes
ETHTOOL_OPTS="wol g"
______________________
chkconfig network on

Wake up the computer from internet
This involves enabling port forwarding of UDP port 9 to the destination computer in the router's administration webpage. 
To fully benefit from WOL you should configure a dynamic DNS service.
Just make sure to use your dynamic DNS provided address and the destination computer's MAC.


### Wine fonts ###
rpm --nodeps -e wine-tahoma-fonts.noarch
wget http://files.polosatus.ru/winefontssmoothing_en.sh
bash winefontssmoothing_en.sh


### dd ###
# format a USB #
dd if=/dev/zero of=/dev/sdX
# see the progress of dd #
ps -A | grep dd
sudo kill -USR1 {nr of PID}


### mc ###
gnome-terminal --geometry=239x68 -e "mc -S featured.ini"


### GIT HUB ###
ssh-keygen -t rsa -C "contact.sergiuniculescu@gmail.com"
vim ~/.ssh/id_rsa.pub  # copy key and paste it to github.com

git config --global user.name "Sergiu Niculescu"
git config --global user.email contact.sergiuniculescu@gmail.com


### Install Skype manually ###
yum install alsa-lib.i686 fontconfig.i686 freetype.i686 glib2.i686 libSM.i686 libXScrnSaver.i686 libXi.i686 libXrandr.i686 libXrender.i686 libXv.i686 libstdc++.i686 pulseaudio-libs.i686 qt.i686 qt-x11.i686 zlib.i686

wget http://download.skype.com/linux/skype_static-4.0.0.8.tar.bz2
mkdir /opt/skype
tar xvf skype_static* -C /opt/skype --strip-components=1

cd /usr/lib
ln -s libtiff.so.3 /usr/lib/libtiff.so.4

ln -s /opt/skype/skype.desktop /usr/share/applications/skype.desktop
ln -s /opt/skype/icons/SkypeBlue_48x48.png /usr/share/icons/skype.png
ln -s /opt/skype/icons/SkypeBlue_48x48.png /usr/share/pixmaps/skype.png
 
touch /usr/bin/skype
chmod 755 /usr/bin/skype
	
vim /usr/bin/skype
_______________
#!/bin/sh
export SKYPE_HOME="/opt/skype"
 
$SKYPE_HOME/skype --resources=$SKYPE_HOME $*
________________


### Install nVidia drivers manually ###
yum groupinstall "Development Tools"
yum install kernel-devel kernel-headers dkms
lspci | grep VGA
http://www.nvidia.com/Download/index.aspx  # download nVidia driver
vim /etc/modprobe.d/blacklist.conf   # blacklist nouveau
mv /boot/initramfs-$(uname -r).img /boot/initramfs-$(uname -r).img.bak
dracut -v /boot/initramfs-$(uname -r).img $(uname -r)
/sbin/init 3
chmod +x NVIDIA-Linux-x86-319.32.run
./NVIDIA-Linux-x86-319.32.run


### rsync ###
rsync -a --progress rsync://ftp.astral.ro/distros/centos/6.4/os/x86_64/ /opt/mirror/centos

system-config-kickstart  #  A graphical interface for making kickstart files

