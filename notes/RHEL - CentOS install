###########################
### RHEL/CentOS install ###
###########################

###########
### yum ###
###########

yum update		# update toate pachetele si dependintele lor
yum search nume_pachet	# cauta un anume pachet, pot fi mai multe pachete trecute
yum info nume_pachet	# afiseaza detalii despre un anume pachet
yum list nume_pache    	# afiseaza informatii despre un anumit pachet, instalat sau nu
yum list nume_pachet\* 	# afiseaza informatii despre toate pachetele care incep cu un nume
yum list all		# afiseaza toate pachetele disponibile 
yum list installed "*nume_pachet*"  # afiseaza pachetele instalate care contine un nume
yum list installed | grep reponame  # afiseaza pachetele instalate dintr-un repo
yum list available	# afiseaza pachetele disponibile in functie de repo-urile instalate
yum repolist		# afiseaza repo-urile instalate
yum gruplist		# afiseaza
yum install nume_pachet\* # instaleaza toate pachetele care incep cu un nume
yum downgrade nume_pachet
yum provides "*/nume_pachet" # afiseaza fisierele care le detine un pachet
yum -v grouplist kde\*  # listeaza toate pachetele ce tin de KDE
yum groupinstall "KDE Software Compilation" # instaleaza toate pachetele ce tin de KDE
yum groupinstall kde-desktop
yum install @kde-desktop  # @ pentru a instala un grup
yum remove nume_pachet
yum groupremove "KDE Software Compilation"
yum groupremove kde-desktop
yum remove @kde-desktop
yum history list
yum history list nume_pachet
yum repolist all  # list all repositories set up on your system


################
### yum.conf ###
################

### skip updating packages ###
yum -x nume_pachet update
yum --exclude=nume_pachet update

sudo vim /etc/yum.conf  # permanent
_______
[main]
exclude=nume_pachet1* nume_pachet2*
_______
yum --disableexcludes=all update  # disable exclude to check for an update


### Remove Old Kernels ###
# Package-cleanup set count as how many old kernels you want left #
package-cleanup --oldkernels --count=2

# Make Amount of Installed Kernels Permanent #
vim /etc/yum.conf # and set installonly_limit:
installonly_limit=2

### Removing dependencies###
sudo vim /etc/yum.conf
______________________________
[main]
clean_requirements_on_remove=1
______________________________


######################
### YUM & RPM tips ###
######################

#Query packages not from CentOS #
rpm -qa --qf '%{NAME} %{VENDOR}\n' | grep -v CentOS

# Reset File Permissions #
rpm --setperms <packagename>

# View the Changelog of a package #
rpm -q --changelog <packagename> | less

# quickly list documentation relating to a package #
rpm -qd <packagename>

# Query Package Install Order and Dates #
rpm -qa --last > ~/RPMS_by_Install_Date

# Query Available Packages from a Repo #
yum --disablerepo "*" --enablerepo "rpmforge" list available 

# Enable or Disable a Repo from the Command Line #
yum-config-manager --enable c6-media
yum-config-manager --disable c6-media

# Show all installed GPG keys #
rpm -q gpg-pubkey --qf '%{name}-%{version}-%{release} --> %{summary}\n'


### package-cleanup ###
package-cleanup --orphans
package-cleanup --leaves
package-cleanup --dupes
package-cleanup --problems
package-cleanup --oldkernel



### Fonts config ###
vim ~/.fonts.conf
__________________________________________
<?xml version='1.0'?>
<!DOCTYPE fontconfig SYSTEM 'fonts.dtd'>
<fontconfig>
 <match target="font">
  <edit mode="assign" name="rgba">
   <const>rgb</const>
  </edit>
 </match>
 <match target="font">
  <edit mode="assign" name="hinting">
   <bool>true</bool>
  </edit>
 </match>
 <match target="font">
  <edit mode="assign" name="hintstyle">
   <const>hintslight</const>
  </edit>
 </match>
 <match target="font">
  <edit mode="assign" name="antialias">
   <bool>true</bool>
  </edit>
 </match>
  <match target="font">
    <edit mode="assign" name="lcdfilter">
      <const>lcddefault</const>
    </edit>
  </match>
</fontconfig>
__________________________________________


### Add an user to SUDOERS ###
su -
visudo
sergiu		ALL=(ALL)	ALL


#############
### Repos ###
#############
rpm -Uvh http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm

# Multimedia #
rpm -Uvh http://pkgs.repoforge.org/rpmforge-release/rpmforge-release-0.5.3-1.el6.rf.x86_64.rpm

rpm -Uvh http://li.nux.ro/download/nux/dextop/el6/x86_64/nux-dextop-release-0-2.el6.nux.noarch.rpm
sudo yum --enablerepo=nux-dextop-testing install xbmc

# nVidia driver #
rpm -Uvh http://elrepo.org/elrepo-release-6-5.el6.elrepo.noarch.rpm
http://elrepo.org/linux/extras/el6/x86_64/RPMS/   # extras
http://elrepo.org/linux/testing/el6/x86_64/RPMS/  # testing
sudo yum install kmod-nvidia
sudo yum install nvidia-x11-drv

# Last kernel & lts kernel #
http://elrepo.org/linux/kernel/el6/x86_64/RPMS/   # kernel
sudo yum --enablerepo=elrepo-kernel install kernel-lt
sudo yum --enablerepo=elrepo-kernel install kernel-ml

# Others (not needed if nux-dextop is installed)
rpm -Uvh http://download1.rpmfusion.org/free/el/updates/6/x86_64/rpmfusion-free-release-6-0.1.noarch.rpm http://download1.rpmfusion.org/nonfree/el/updates/6/x86_64/rpmfusion-nonfree-release-6-0.1.noarch.rpm


### Install nVidia drivers manually ###
yum groupinstall "Development Tools"
yum install kernel-devel kernel-headers dkms
lspci | grep VGA
http://www.nvidia.com/Download/index.aspx  # download nVidia driver
vim /etc/modprobe.d/blacklist.conf   # blacklist nouveau
mv /boot/initramfs-$(uname -r).img /boot/initramfs-$(uname -r).img.bak
dracut -v /boot/initramfs-$(uname -r).img $(uname -r)
/sbin/init 3
chmod +x NVIDIA-Linux-x86-319.32.run
./NVIDIA-Linux-x86-319.32.run



### Install Chromium ###
cd /etc/yum.repos.d
wget http://people.centos.org/hughesjr/chromium/6/chromium-el6.repo
yum install chromium


### Others ###
yum install bash-completion
yum install nautilus-open-terminal
yum install flash-plugin
yum install gnome-utils
yum install file-roller
yum install ntfsprogs


### Install Skype manually ###
yum install alsa-lib.i686 fontconfig.i686 freetype.i686 glib2.i686 libSM.i686 libXScrnSaver.i686 libXi.i686 libXrandr.i686 libXrender.i686 libXv.i686 libstdc++.i686 pulseaudio-libs.i686 qt.i686 qt-x11.i686 zlib.i686

wget http://download.skype.com/linux/skype_static-4.0.0.8.tar.bz2
mkdir /opt/skype
tar xvf skype_static* -C /opt/skype --strip-components=1

cd /usr/lib
ln -s libtiff.so.3 /usr/lib/libtiff.so.4

ln -s /opt/skype/skype.desktop /usr/share/applications/skype.desktop
ln -s /opt/skype/icons/SkypeBlue_48x48.png /usr/share/icons/skype.png
ln -s /opt/skype/icons/SkypeBlue_48x48.png /usr/share/pixmaps/skype.png
 
touch /usr/bin/skype
chmod 755 /usr/bin/skype
	
vim /usr/bin/skype
_______________
#!/bin/sh
export SKYPE_HOME="/opt/skype"
 
$SKYPE_HOME/skype --resources=$SKYPE_HOME $*
________________


### Change the hostname ###
hostname   # to check your hostname
sudo hostname RedHat
vim /etc/sysconfig/network


### Dropbox ###
vim /etc/sysconfig/dropbox  # DROPBOX_USERS="sergiu"
echo '-b /usr/libexec/dropbox/' > /etc/prelink.conf.d/dropbox.conf
yum --enablerepo rpmforge reinstall dropbox


### Install LibreOffice 4.1.0 ###
wget http://download.documentfoundation.org/libreoffice/stable/4.1.0/rpm/x86_64/LibreOffice_4.1.0_Linux_x86-64_rpm.tar.gz
tar -xvf LibreOffice_4.1.0*
cd LibreOffice_4.1.0*
yum localinstall RPMS/*.rpm RPMS/desktop-integration/libreoffice4.1-freedesktop-menus-4.1.0*.noarch.rpm


### Install vbox additions ###
yum install gcc kernel-devel kernel-headers dkms make bzip2
KERN_DIR=/usr/src/kernels/`uname -r`
export KERN_DIR
cd /media/VirtualBoxGuestAdditions
./VBoxLinuxAdditions.run


### Remove boot splash screen ###
vim /etc/grub.conf  # remove ‘rhgb’ and ‘quiet’


### Remove Desktop icons ###
yum install gconf-editor
apps > nautilus > desktop


### Multimedia support ###
sudo yum install gstreamer gstreamer-plugins-base gstreamer-plugins-good gstreamer-plugins-bad-free
sudo yum install gstreamer-plugins-bad gstreamer-plugins-ugly gstreamer-ffmpeg


### Save alsamixer settings ###
sudo alsactl store
ls -Z /etc/asound.*  # to see SElinux label

sudo vim /etc/pulse/daemon.conf
_______________________________
enable-remixing = yes
enable-lfe-remixing = yes
default-sample-format = s32le
default-sample-rate = 48000
default-sample-channels = 6
default-fragments = 8
default-fragment-size-msec = 5
________________________________

pulseaudio -k  # restart pulseaudio



#########################
### CentOS Protection ###
#########################


### SElinux ###

# You can view current status of SELinux mode from the command line using these:
system-config-selinux
getenforce
sestatus

# If it is disabled, enable SELinux using the following command.
setenforce enforcing  # changes do not persist through a system reboot
To make changes persistent through a system reboot, edit the 'SELINUX=' line in  /etc/selinux/config for either 'enforcing', 'permissive', or 'disabled'. For example: 'SELINUX=permissive'

# SElinux re-labelling #
touch /.autorelabel
sudo reboot

### Password Protect Grub and Single-User Mode ###
grub-crypt
vim /etc/grub.conf
______________________________________________
default=0
timeout=5
password --encrypted $6$w1lrwrXOMm5ueR4M$.....
______________________________________________

vim /etc/sysconfig/init
_______________________
SINGLE=/sbin/sulogin
_______________________


### Modifying fstab ###
vim /etc/fstab
____________________________________________________________________
/dev/sda1	/boot	ext4	defaults,nosuid,noexec,nodev	1 2
/dev/sda2	swap	swap	defaults			0 0
/dev/sda3	/		ext4	defaults		1 1
/dev/sda4	/home	ext4	defaults,nosuid,nodev		1 2
____________________________________________________________________

# Keep /boot as read-only #
# Note that you need to reset the change to read-write if you need to upgrade the kernel in future
/dev/sda1	/boot	ext4	defaults,nosuid,noexec,nodev,ro	1 2


### Disable Control -Alt -Delete keys on the console mode ###
vim /etc/init/control-alt-delete.conf
______________________________
# start on control-alt-delete
# exec /sbin/shutdown -r now "Control -Alt -Delete pressed"
______________________________


### Disable USB mass storage ###
echo "Disabling USB Mass Storage"
echo "blacklist usb-storage" > /etc/modprobe.d/blacklist-usbstorage

### Disable USB stick to detect ###
vim /etc/modprobe.d/no-usb
_____________________________
install usb-storage /bin/true
_____________________________


### Update your system to use sha512 instead of md5 for password protection ###
authconfig --passalgo=sha512 --update


### Sysctl Security ###
vim /etc/sysctl.conf
_______________________________________________
# Security options #
net.ipv4.conf.all.send_redirects = 0
net.ipv4.conf.all.accept_source_route = 0
net.ipv4.conf.all.accept_redirects = 0
net.ipv4.conf.all.secure_redirects = 0
net.ipv4.conf.all.rp_filter = 1
net.ipv4.conf.all.log_martians = 1
net.ipv4.conf.default.accept_redirects = 0
net.ipv4.conf.default.secure_redirects = 0
net.ipv4.conf.default.send_redirects = 0
net.ipv4.icmp_echo_ignore_broadcasts = 1
net.ipv4.icmp_ignore_bogus_error_responses = 1
net.ipv4.tcp_max_syn_backlog = 1280
net.ipv4.tcp_timestamps = 0

# Memory/Swap Use 
vm.swappiness = 10
_______________________________________________

sysctl -p


### Services configuration ###

chkconfig --list		# list all known services
chkconfig --list | grep 3:on	# list running services
chkconfig [service] on/off	# turn on / off service
netstat -tulpn			# list service and their open ports


chkconfig atd off
chkconfig blk-availability off
chkconfig mdmonitor off
chkconfig lvm2-monitor off
sudo chkconfig iscsi off
sudo chkconfig iscsid off
chkconfig nfslock off
chkconfig rpcbind off
chkconfig rpcgssd off
chkconfig rpcidmapd off
chkconfig livesys off
chkconfig livesys-late off
chkconfig pcscd off
chkconfig openct off



##############
### Others ###
##############

### Wake-on-lan ###
echo '/usr/sbin/ethtool -s eth0 wol g' >> /etc/rc.d/rc.local
or
vim /etc/sysconfig/network-scripts/ifcfg-eth0
_____________________
DEVICE=eth0
TYPE=EThernet 
ONBOOT=yes
ETHTOOL_OPTS="wol g"
______________________
chkconfig network on

Wake up the computer from internet
This involves enabling port forwarding of UDP port 9 to the destination computer in the router's administration webpage. 
To fully benefit from WOL you should configure a dynamic DNS service.
Just make sure to use your dynamic DNS provided address and the destination computer's MAC.


### Wine fonts ###
rpm --nodeps -e wine-tahoma-fonts.noarch
wget http://files.polosatus.ru/winefontssmoothing_en.sh
bash winefontssmoothing_en.sh


### dd ###
# format a USB #
dd if=/dev/zero of=/dev/sdX
# see the progress of dd #
ps -A | grep dd
sudo kill -USR1 {nr of PID}



### rsync ###
rsync -a --progress rsync://ftp.astral.ro/distros/centos/6.4/os/x86_64/ /opt/mirror/centos

system-config-kickstart  #  A graphical interface for making kickstart files

